## 現在の作業フォーカス
- 口腔機能検査・全身機能評価・管理計画書作成のUI/UXリファイン
- Next.js 15 + Supabase構成での本番運用を見据えたCRUD・UI・データ設計の安定化
- 管理計画書作成ページ（/examinations/detail/[id]/management-plan-edit）の新規実装とUX改善
- **患者基本情報登録画面のage入力欄廃止・birthday（生年月日）入力欄追加・年齢自動計算表示への移行**
- **全身の状態セクションのUI刷新・重複排除・localStorage保存・プリント連携**
- 管理計画書作成ページへの「印刷」ボタン追加、印刷ページへの「戻る」ボタン追加
- JSX構造・styleタグの不整合修正
- メモリーバンクのドキュメントと実装進捗の完全同期
- **患者一覧画面の統一（app/patients/page.tsxに集約）、トップページから/patientsへの自動リダイレクト対応**
- **印刷ページでSupabaseデータのスネークケース→キャメルケース変換処理を追加し、数値が正しく表示されるよう修正**
- **Next.js 15のparams Promise対応や、Supabaseデータの型変換パターンの確立**
- **管理計画書作成ページ・印刷ページ・検査詳細ページで、患者情報（氏名・生年月日・性別・年齢）をSupabaseのpatientsテーブルから取得し、年齢は生年月日から自動計算して表示するよう統一**

## 最近の変更・進捗
- 患者新規登録フォームからage（年齢）入力欄を削除し、birthday（生年月日）入力欄（type="date"、任意入力）を追加
- APIロジックでageを廃止し、birthdayを送信するよう修正
- 患者一覧・詳細画面でageカラムを廃止し、birthdayから年齢を自動計算して表示（未入力時は「-」表示）
- 型定義・バリデーション・UI/UXを全てage廃止・birthday基準に統一
- /examinations/detail/[id]/management-plan-edit ページに「印刷」ボタンを追加し、印刷ページ（/examinations/detail/[id]/management-plan-edit/print）へ遷移可能に
- 印刷ページに「戻る」ボタンを追加し、作成ページへ遷移可能に
- JSX構造・styleタグの不整合を修正し、エラーのない状態に
- 患者情報・検査日などをSupabaseから取得し、UI上部にCardで見やすく表示
- **全身の状態セクションを、ご指定のUI（チェックボックス・セレクト・数値入力・詳細テキスト＋身長体重BMI）で1箇所に統一。重複UIを排除し、state設計を刷新。**
- **全身の状態の入力内容をlocalStorageに保存し、プリントページで正しく反映されるように連携。複数選択や詳細入力も正しく展開。**
- 体組成測定・管理計画書印刷・詳細表示など、主要なUI/機能が段階的にリファイン・分離
- コードは常に最新の状態で保存・反映
- **患者一覧画面の統一（app/patients/page.tsxに集約）、トップページ（/）から/patientsへの自動リダイレクトを実装**
- **PatientsList.tsxのUIを改善し、「操作」列を削除、行クリックで詳細ページ遷移に統一**
- **印刷ページでoral_function_examテーブルのスネークケース→キャメルケース変換処理を追加し、pa_sound, ta_sound, ka_sound, mucus_value, occlusion_force等の数値が正しく表示されるよう修正**
- **Next.js 15のparams Promise対応や、Supabaseデータの型変換パターンが確立**
- **管理計画書作成ページ・印刷ページ・検査詳細ページで、患者情報（氏名・生年月日・性別・年齢）をSupabaseのpatientsテーブルから取得し、年齢は生年月日から自動計算して表示するよう統一**
- **ExaminationDetailClient等のprops設計を拡張し、患者情報の一貫表示・型安全化を実現**

## 次のステップ
- 管理計画書作成ページのさらなるUX改善・バリデーション・保存/プレビュー連携
- 口腔機能管理計画セクションのUIリファイン・保存機能
- 必要に応じてAPI連携・保存・印刷連携の強化
- 他セクションのUI/UX最適化
- 実装進捗・課題・学びを随時activeContext.mdに記録

## アクティブな意思決定・考慮事項
- UI/UXは現場運用・可読性・操作性重視
- shadcn/ui, Tailwind CSS, Next.js 15 App Router構成を積極活用
- Supabaseからのデータ取得はServer/Client両対応
- コード・ドキュメントは常に最新状態を維持
- **患者基本情報の年齢は入力させず、birthday（生年月日）から自動計算して表示する方針に統一**
- **フォームのstate設計は型安全・拡張性重視で刷新。localStorage連携も型を明示して管理。**
- **患者一覧画面はapp/patients/page.tsxに統一し、トップページ（/）は/patientsへリダイレクトする構成に決定**
- **PatientsList.tsxは行クリックで詳細遷移、操作列廃止のUI/UXに統一**
- **Supabaseデータのスネークケース→キャメルケース変換パターンを今後のデータ表示にも適用する方針**
- **管理計画書作成・印刷・検査詳細ページで、患者情報は必ずpatientsテーブルから取得し、年齢は生年月日から自動計算する設計を徹底**
- **ExaminationDetailClient等のprops設計を拡張し、患者情報の一貫表示・型安全化を重視**

## 重要なパターン・知見
- hooks/でロジック分離、components/でUI分割、lib/でユーティリティ管理
- shadcn/ui, Tailwind CSSによるUI/UX最適化
- Supabase公式SDK・Next.js App Routerの活用
- paramsのPromise対応・"use client"ディレクティブの適用による最新Next.js仕様への追従
- MCPツールによるDBマイグレーション・テストデータ投入の自動化
- **localStorageを用いた一時保存・プリント連携のパターンを確立**
- **画面統一・リダイレクト・UI/UX一貫性のためのルーティング/コンポーネント設計パターンを確立**
- **Supabaseから取得したデータのスネークケース→キャメルケース変換パターンを確立し、データ表示の一貫性・保守性を向上**
- **管理計画書作成・印刷・検査詳細ページで、患者情報はpatientsテーブルから取得し、年齢は生年月日から自動計算するパターンを確立**
- **サーバー/クライアント両対応で型安全にデータを受け渡すprops設計・UIパターンを確立**
