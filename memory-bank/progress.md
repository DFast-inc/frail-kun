## 現在動作しているもの
- **口腔衛生状態（舌苔スコア/TCI）判定ロジック・UIパターンを刷新（6ブロック・TCI計算・50%以上で異常）し、他検査と同様のリアルタイム判定・UI/UXパターンを確立**
- 口腔機能検査・全身機能評価・管理計画書作成の主要UI/機能（Next.js 15 + Supabase構成）
- **患者新規登録・編集画面（/patients/new, /patients/[patientId]/edit）がPatientForm.tsxでUI/UX・バリデーション・アクセシビリティ共通化された状態で安定動作**
- **患者編集画面はSupabaseから初期値を取得し、編集・保存（update）が可能**
- **hooks/useUpdatePatient.tsによるupdateロジックの共通化**
- **患者新規登録時、patients.idを取得し、検査登録画面へidをパスパラメータで遷移するフローが安定動作**
- **oral_function_examのinsert時、必ずpatients.id（パスパラメータ）をpatient_idとして保存し、外部キー制約違反（Key (patient_id) is not present in table "patients"）が発生しない**
- **検査データ保存後、Supabaseのinsert直後に.select().single()で新規idを取得し、検査結果詳細画面へ遷移するフローが安定動作**
- **lib/oralFunctionAssessmentJudge.tsのjudgeBitingForce関数で、フィルタ無し:500N以上、フィルタあり:350N以上で正常判定となるよう修正。不等号バグも解消**
- 管理計画書作成ページの全体ラッパー・患者情報表示・フォーム本体をshadcn/uiのCardで統一
- **患者詳細ページ（app/patients/[patientId]/page.tsx）のアコーディオン化・健康スコア/診断バッジ/プログレスバーの自動化・診断名自動生成・UI/UXリファインが安定動作**
- **口腔機能検査記録印刷ページ（/patients/[patientId]/examinations/oral-function-assessment/[oralFunctionAssessmentId]/print）の新規実装・A4印刷レイアウト・params Promise対応・ID整合性チェック・null時のデバッグパターンが確立**
- **printページのoralExamサブオブジェクトに空オブジェクト初期値（?? {}）を与え、undefinedアクセスエラー（Cannot read properties of undefined）を根本解消し、詳細画面と同様の安定動作を実現**
- **oral_function_examテーブルのカラム名に合わせてprint/page.tsxの検査値表示ロジックを修正。Supabaseの実データ構造（プリミティブ値）をMCP経由で調査し、items配列のkeyをDBカラム名に正規化。検査値が正しく反映されるようになった**
- **「該当」欄を下位症状ごとに1つだけまとめて表示するようにUI/ロジックを修正。checkedCountのロジックとUIの一貫性を確保**
- **検査詳細ページ（ExaminationDetailClient.tsx）に「印刷」ボタンを追加し、印刷ページへ遷移できるようにした**

## 今後実装すべきもの
- **患者編集画面の更なるUX改善・バリデーション強化・エラーハンドリングの拡充**
- 管理計画書作成ページのさらなるUX改善・バリデーション・保存/プレビュー連携
- 口腔機能管理計画セクションのUIリファイン・保存機能
- 必要に応じてAPI連携・保存・印刷連携の強化
- 他セクションのUI/UX最適化
- ドキュメント・学びの随時反映

## 現在のステータス
- **口腔衛生状態（TCI）判定の新パターン（6ブロック・TCI計算・50%以上で異常）が安定動作。他検査と同様のリアルタイム判定・UI/UXパターンを再利用可能**
- **患者新規登録→検査登録のid受け渡し・外部キー制約違反の解消・保存後の詳細画面遷移が一貫して安定動作**
- **咬合力判定条件（フィルタ有無で基準値分岐）のバグが解消され、現場運用仕様に準拠**
- **患者詳細ページのアコーディオン化・健康スコア/診断バッジ/診断名自動生成・UI/UXリファインが現場運用・拡張性・一貫性を高いレベルで両立し、安定動作**
- **印刷ページのparams Promise対応・ID整合性チェック・null時のデバッグパターンも現場運用レベルで確立**
- **printページのoralExamサブオブジェクトに空オブジェクト初期値を与え、データ取得・初期値補完パターンを詳細画面と統一し、undefinedアクセスエラーを根本解消**
- **oral_function_examテーブルのカラム名に合わせてprint/page.tsxの検査値表示ロジックを修正。Supabaseの実データ構造（プリミティブ値）をMCP経由で調査し、items配列のkeyをDBカラム名に正規化。検査値が正しく反映されるようになった**
- **「該当」欄を下位症状ごとに1つだけまとめて表示するようにUI/ロジックを修正。checkedCountのロジックとUIの一貫性を確保**
- **検査詳細ページ（ExaminationDetailClient.tsx）に「印刷」ボタンを追加し、印刷ページへ遷移できるようにした**

## 既知の課題・懸念点
- **患者編集画面のバリデーション・UX改善・エラーハンドリング強化**
- 管理計画書作成ページのバリデーション・保存/プレビュー連携
- 口腔機能管理計画セクションのさらなるUX改善
- API連携・保存・印刷連携の強化
- 他セクションのUI/UX最適化
- **Supabaseデータ取得時のID不一致・データ欠損時のエラー検知・デバッグパターンの徹底**

## プロジェクト意思決定の変遷
- **口腔衛生状態（TCI）判定の新パターン（6ブロック・TCI計算・50%以上で異常）を確立。他検査と同様のリアルタイム判定・UI/UXパターンを再利用可能**
- **患者新規登録→検査登録のid受け渡し・外部キー制約違反の解消・保存後の詳細画面遷移のパターンを確立**
- **咬合力判定条件（フィルタ有無で基準値分岐）のバグ解消・仕様明示**
- **患者詳細ページのアコーディオン化・健康スコア/診断バッジ/診断名自動生成・UI/UXリファインのパターンを確立し、今後の他画面・他機能でも再利用可能な設計とした**
- **印刷ページ設計・params Promise対応・ID整合性チェック・null時のデバッグパターンを確立し、Next.js 15/Supabaseの最新仕様・現場運用要件に完全準拠**
- **printページのoralExamサブオブジェクトに空オブジェクト初期値を与え、データ取得・初期値補完パターンを詳細画面と統一し、undefinedアクセスエラーを根本解消**
- **oral_function_examテーブルのカラム名に合わせてprint/page.tsxの検査値表示ロジックを修正。Supabaseの実データ構造（プリミティブ値）をMCP経由で調査し、items配列のkeyをDBカラム名に正規化。検査値が正しく反映されるようになった**
- **「該当」欄を下位症状ごとに1つだけまとめて表示するようにUI/ロジックを修正。checkedCountのロジックとUIの一貫性を確保**
- **検査詳細ページから印刷ページへの遷移UIパターンを確立**
- ...（従来の意思決定も維持）
